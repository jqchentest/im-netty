<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>im</title></head>
    <script src="js/common/jquery-1.9.1.min.js"></script>
    <script src="js/chatroom.js"></script>

<body>
    <span>
        <input type="text" id="user-id"/>
        <button id="login-btn">登录</button><br><br><br>
    </span>

    <span>
        <textarea id="content" rows="10" cols="70"></textarea>
        <button id="send-btn">发送</button>
    </span>
    <span>
        <h3 id="msg"></h3>
    </span>
</body>

<script type="text/javascript">
    var socket;

    if (!window.WebSocket) {
        window.WebSocket = window.MozWebSocket;
    }
    if (window.WebSocket) {
        socket = new WebSocket("ws://localhost:8988");
        socket.onmessage = function (event) {
            $('#msg').append("<br/><span style='color:darkkhaki'>" + event.data + "</span>");
        };

        // 连接成功1秒后，将用户信息注册到服务器在线用户表
        socket.onopen = setTimeout(function (event) {
            console.log("WebSocket已成功连接！");
        }, 1000)

        socket.onclose = function (event) {
            console.log("WebSocket已关闭...");
        };
    } else {
        alert("您的浏览器不支持WebSocket！");
    }

    // 绑定发送按钮点击事件
    $('#send-btn').on('click', function () {
        var userId = $('#user-id').val();
        var friendId = userId / 2;
        if (friendId < 1) {
            friendId = 2;
        }
        var content = $('#content').val();
        $('#content').val("");
        ws.sendContent(userId, friendId, content);
        $('#msg').append("<br/><span style='color:darkgreen'>" + content + "</span>");
    })

    // 绑定发送按钮点击事件
    $('#login-btn').on('click', function () {
        var userId = $('#user-id').val();
        ws.login(userId);
    })
</script>

</html>